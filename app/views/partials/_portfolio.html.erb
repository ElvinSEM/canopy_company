<!-- app/views/partials/_portfolio.html.erb -->
<section id="portfolio" class="py-20 bg-gradient-to-br from-slate-50 to-blue-50/50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">–ù–∞—à–∏ —Ä–∞–±–æ—Ç—ã</h2>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã –≥–æ—Ä–¥–∏–º—Å—è
      </p>
    </div>

    <% projects = [
      {
        image: 'workflow1.jpeg',
        title: '–ù–∞–≤–µ—Å –¥–ª—è 3 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π',
        category: '–ß–∞—Å—Ç–Ω—ã–π –¥–æ–º',
        location: '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        description: '–ü—Ä–æ—Å—Ç–æ—Ä–Ω—ã–π —Ç—Ä–µ—Ö–º–µ—Å—Ç–Ω—ã–π –Ω–∞–≤–µ—Å —Å —É—Å–∏–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏–∑ —Å—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–æ—Ç–æ–≤—ã–º –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç–æ–º. –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–µ–º—å–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏.',
        duration: '7 –¥–Ω–µ–π',
        area: '45 –º¬≤',
        materials: '–°—Ç–∞–ª—å, –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç',
        price: '–æ—Ç 120 000 ‚ÇΩ'
      },
      {
        image: 'logo1.jpeg',
        title: '–¢–µ—Ä—Ä–∞—Å–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞',
        category: '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π',
        location: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
        description: '–≠–ª–µ–≥–∞–Ω—Ç–Ω–∞—è —Ç–µ—Ä—Ä–∞—Å–∞ –¥–ª—è –ª–µ—Ç–Ω–µ–≥–æ —Å–µ–∑–æ–Ω–∞ —Å —Ä–∞–∑–¥–≤–∏–∂–Ω–æ–π –∫—Ä—ã—à–µ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–¥–æ–≥—Ä–µ–≤–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∫—Ä—É–≥–ª—ã–π –≥–æ–¥.',
        duration: '14 –¥–Ω–µ–π',
        area: '80 –º¬≤',
        materials: '–ê–ª—é–º–∏–Ω–∏–π, —Å—Ç–µ–∫–ª–æ',
        price: '–æ—Ç 350 000 ‚ÇΩ'
      },
      {
        image: 'workflow5.jpeg',
        title: '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –Ω–∞–≤–µ—Å',
        category: '–°–∫–ª–∞–¥—Å–∫–æ–π –∫–æ–º–ø–ª–µ–∫—Å',
        location: '–ö–∞–∑–∞–Ω—å',
        description: '–ü—Ä–æ—á–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö —É—Å–ª–æ–≤–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏. –í—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Å–Ω–µ–≥–æ–≤—ã–µ –∏ –≤–µ—Ç—Ä–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏.',
        duration: '21 –¥–µ–Ω—å',
        area: '200 –º¬≤',
        materials: '–°—Ç–∞–ª—å, –ø—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª',
        price: '–æ—Ç 500 000 ‚ÇΩ'
      },
      {
        image: 'workflow3.jpeg',
        title: '–ù–∞–≤–µ—Å –¥–ª—è –±–∞—Å—Å–µ–π–Ω–∞',
        category: '–ß–∞—Å—Ç–Ω—ã–π –¥–æ–º',
        location: '–°–æ—á–∏',
        description: '–ó–∞—â–∏—Ç–∞ –æ—Ç —É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç–∞ –∏ –º—É—Å–æ—Ä–∞ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç–æ–º. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤–æ–¥—ã.',
        duration: '10 –¥–Ω–µ–π',
        area: '30 –º¬≤',
        materials: '–ê–ª—é–º–∏–Ω–∏–π, –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç',
        price: '–æ—Ç 180 000 ‚ÇΩ'
      },
      {
        image: 'workflow2.jpeg',
        title: '–¢–µ—Ä—Ä–∞—Å–∞ –∫–∞—Ñ–µ',
        category: '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π',
        location: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥',
        description: '–£—é—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –≥–æ—Å—Ç–µ–π —Å –ø–æ–¥–æ–≥—Ä–µ–≤–æ–º –≤ —Ö–æ–ª–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—Å–∞–¥–∫–æ–≤.',
        duration: '12 –¥–Ω–µ–π',
        area: '60 –º¬≤',
        materials: '–î–µ—Ä–µ–≤–æ, –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç',
        price: '–æ—Ç 280 000 ‚ÇΩ'
      },
      {
        image: 'canopy.jpeg',
        title: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
        category: '–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π',
        location: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫',
        description: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º. –°–æ—á–µ—Ç–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —ç—Å—Ç–µ—Ç–∏–∫–∏.',
        duration: '30 –¥–Ω–µ–π',
        area: '150 –º¬≤',
        materials: '–°—Ç–∞–ª—å, —Å—Ç–µ–∫–ª–æ, –¥–µ—Ä–µ–≤–æ',
        price: '–æ—Ç 650 000 ‚ÇΩ'
      }
    ] %>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
      <% projects.each_with_index do |project, index| %>
        <div class="bg-white rounded-xl md:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden group">
          <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤—ã—Å–æ—Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è) -->
          <div class="h-40 sm:h-48 bg-gray-100 overflow-hidden relative">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            <%= vite_image_tag("images/#{project[:image]}",
                               alt: project[:title],
                               class: "w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",
                               loading: index < 2 ? "eager" : "lazy",  # –ü–µ—Ä–≤—ã–µ 2 –≥—Ä—É–∑–∏–º —Å—Ä–∞–∑—É
                               data: { fallback: "true" }) %>

            <!-- –§–æ–ª–±—ç–∫-–∑–∞–≥–ª—É—à–∫–∞ -->
            <div id="fallback-<%= project[:image].parameterize %>"
                 class="absolute inset-0 bg-gradient-to-br from-blue-400 to-cyan-500 flex items-center justify-center hidden">
              <div class="w-12 sm:w-16 h-12 sm:h-16 bg-white/20 rounded-full flex items-center justify-center text-white text-xl sm:text-2xl backdrop-blur-sm">
                üì∑
              </div>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
          <div class="p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-1 sm:mb-2 leading-tight">
              <%= project[:title] %>
            </h3>

            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-0 text-xs sm:text-sm text-gray-600 mb-2 sm:mb-3">
              <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium inline-block w-fit">
                <%= project[:category] %>
              </span>
              <span class="text-gray-500"><%= project[:location] %></span>
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ (—É—Ä–µ–∑–∞–Ω–Ω–æ–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
            <p class="text-gray-600 text-xs sm:text-sm mb-3 sm:mb-4 leading-relaxed line-clamp-2 sm:line-clamp-3">
              <%= project[:description] %>
            </p>

            <!-- –î–µ—Ç–∞–ª–∏ (–∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
            <div class="grid grid-cols-2 gap-1 sm:gap-2 text-xs mb-3 sm:mb-4">
              <% detail_items = [
                ["‚è±Ô∏è", project[:duration]],
                ["üìê", project[:area]],
                ["üèóÔ∏è", project[:materials]],
                ["üí∞", project[:price]]
              ] %>

              <% detail_items.each do |icon, text| %>
                <div class="flex items-center gap-1 overflow-hidden">
                  <span class="text-gray-500 flex-shrink-0"><%= icon %></span>
                  <span class="truncate text-xs"><%= text %></span>
                </div>
              <% end %>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ (–±–æ–ª—å—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–∞–ø–∞) -->
            <button
              onclick="openLeadModal()"
              data-title="<%= project[:title] %>"
              class="lead-modal-btn w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white py-2.5 sm:py-2 rounded-lg font-semibold text-sm transition-all duration-300 active:scale-95 touch-manipulation"
              style="touch-action: manipulation;">
              –ó–∞–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>

<!-- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π JavaScript –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        document.querySelectorAll('img[data-fallback="true"]').forEach(function(img) {
            img.addEventListener('error', function() {
                this.style.display = 'none';
                const imageName = this.src.split('/').pop().replace(/\.\w+$/, '');
                const fallbackId = 'fallback-' + imageName.replace(/[^a-z0-9]/gi, '-').toLowerCase();
                const fallbackElement = document.getElementById(fallbackId);
                if (fallbackElement) {
                    fallbackElement.classList.remove('hidden');
                    fallbackElement.classList.add('flex');
                }
            });
        });

        // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–æ—Ä–º—É
        document.querySelectorAll('.lead-modal-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const projectTitle = this.getAttribute('data-title');
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –∏–ª–∏ data-–∞—Ç—Ä–∏–±—É—Ç
                sessionStorage.setItem('selectedProject', projectTitle || '–ü—Ä–æ–µ–∫—Ç');
            });
        });
    });
</script>