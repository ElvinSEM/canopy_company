<!DOCTYPE html>
<html lang="ru" class="h-full scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= @company&.name || ENV["COMPANY_NAME"] || "ELVINCompany" %></title>

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= vite_client_tag %>
  <%= vite_stylesheet_tag 'application' %>
  <%= vite_javascript_tag 'application' %>

  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body class="min-h-screen bg-gradient-light font-sans">
<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<main class="min-h-screen">
  <%= yield %>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞—è–≤–∫–∏ -->
<%= render "shared/lead_modal" %>

<!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div class="fixed bottom-4 right-4 z-50 space-y-2" id="toast-container"></div>

<!-- –ë–∞–∑–æ–≤—ã–π JavaScript -->
<script>
    // –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    window.debounce = function(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    };

    // Toast —Å–∏—Å—Ç–µ–º–∞
    window.showToast = function(message, type = 'success') {
        const container = document.getElementById('toast-container');
        if (!container) return;

        const toast = document.createElement('div');
        const styles = {
            success: 'bg-gradient-to-r from-green-500 to-emerald-600',
            error: 'bg-gradient-to-r from-red-500 to-pink-600',
            warning: 'bg-gradient-to-r from-orange-500 to-amber-600',
            info: 'bg-gradient-to-r from-blue-500 to-cyan-600'
        };

        toast.className = `
        ${styles[type]} text-white px-6 py-4 rounded-xl shadow-2xl backdrop-blur-sm
        transform transition-all duration-500 opacity-0 translate-y-2
        flex items-center space-x-3 font-medium
      `;

        const icons = {
            success: '‚úÖ',
            error: '‚ùå',
            warning: '‚ö†Ô∏è',
            info: 'üí°'
        };

        toast.innerHTML = `
        <span class="text-lg flex-shrink-0">${icons[type]}</span>
        <span>${message}</span>
      `;

        container.appendChild(toast);

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        requestAnimationFrame(() => {
            toast.classList.remove('opacity-0', 'translate-y-2');
            toast.classList.add('opacity-100');
        });

        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
        setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0', 'translate-y-2');
            setTimeout(() => toast.remove(), 500);
        }, 4000);
    };

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('lead_success')) {
            showToast('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç', 'success');
            // –û—á–∏—â–∞–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
            window.history.replaceState({}, '', window.location.pathname);
        }
    });
</script>
</body>
</html>